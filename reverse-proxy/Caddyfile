#######################################################################
#                                                                     #
#      Do not edit this file directly. Changes are not persisted.     #
#                                                                     #
# Changes via https://github.com/Republique-des-Lettres/reverse-proxy #
#                                                                     #
#######################################################################


# --------------------------------------------------------------------#
# That said, experimenting here is possible. Try to do it in          #
# isolated contexts (so as not to impact other services) and          #
# reload Caddy gracefully to minimise downtime:                       #
#                                                                     #
# caddy reload --config /etc/caddy/Caddyfile --adapter caddyfile      #
#                                                                     #
# Also remember to observe the Let's Encrypt rate limits:             #
# https://letsencrypt.org/docs/rate-limits                            #
# --------------------------------------------------------------------#


# The Caddyfile is an easy way to configure your Caddy web server.
#
# Unless the file starts with a global options block, the first
# uncommented line is always the address of your site.
#
# To use your own domain name (with automatic HTTPS), first make
# sure your domain's A/AAAA DNS records are properly pointed to
# this machine's public IP, then replace ":80" below with your
# domain name.

#sample.hostname.example.org {
	# Set this path to your site's directory.
	# root * /usr/share/caddy

	# Enable the static file server.
	# file_server

	# Another common task is to set up a reverse proxy:
	# reverse_proxy localhost:8080
    
	# Or serve a PHP site through php-fpm:
	# php_fastcgi localhost:9000
#}

(security_headers) {
    header {
        # Strict-Transport-Security "max-age=31536000; includeSubDomains"
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
    }
}

republique-des-lettres.ch, www.republique-des-lettres.ch {
    reverse_proxy 10.102.6.166:80
    import security_headers
}

hallernet.org, www.hallernet.org {
    redir https://republique-des-lettres.ch{uri} 301
}

stats.republique-des-lettres.ch {
    reverse_proxy 10.101.5.58:80
    import security_headers
}

md.republique-des-lettres.ch {
    reverse_proxy 10.101.5.230:80
    import security_headers
}

# for testing purposes:
#foo.republique-des-lettres.ch {
#	reverse_proxy 10.102.6.166:80
#}

#rdl.hallernet.org {
#    redir https://republique-des-lettres.ch{uri} 301
#}

# Refer to the Caddy docs for more information:
# https://caddyserver.com/docs/caddyfile
